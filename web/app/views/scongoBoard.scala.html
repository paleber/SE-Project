@()
<link rel='import' href='@routes.Assets.at("bower_components/polymer/polymer.html")'>
<link rel='import' href='@routes.Assets.at("bower_components/paper-button/paper-button.html")'>

<dom-module id='scongo-board' attributes="name">

    <template>

        <style>
        canvas {
            background-color: lightgrey;
            width: 1000px; /*100%;*/
            height: 600px; /*/80vh;*/
            margin-left: auto;
            margin-right: auto;
            display: block;
        }

        .content {
            display: none;
        }
        </style>

        <div id="menu" class="content">
        @for(level <- persistence.LevelManager.LEVEL_NAMES) {
            <paper-button raised on-click="showLevel" level="@level">@level</paper-button>
        }
        </div>

        <div id="level" class="content">
            <canvas id="can" width="1000" height="600"></canvas>
        </div>

        <div id="closed" class="content">
            <div class="alert alert-info">
                <strong>Connection closed! <a href="@routes.Application.game" class="alert-link">Reconnect</a></strong>
            </div>
        </div>
    </template>


    <script>
            Polymer({
                is: "scongo-board",

                properties: {
                    socket: WebSocket
                },

                ready: function () {
                    this.socket = new WebSocket('ws://localhost:9000/socket');

                    this.socket.onopen = () => {
                        console.log("socket opened");
                        this.socket.send("menu");
                    };

                    this.socket.onerror = msg => {
                        console.log("socket error: " + msg);
                    };

                    this.socket.onmessage = msg => {
                        this.handleMsg(msg);
                        console.log("message received: " + msg)
                    };

                    this.socket.onclose = () => {
                        console.log("socket closed")
                    };
                },

                showLevel: function (e) {
                    this.socket.send("game " + e.target.getAttribute("level"));
                },

                handleMsg: function (msg) {
                    const data = JSON.parse(msg.data);
                    //let type = data.jsonClass;
                    //delete data.jsonClass;

                    switch (data.jsonClass) {
                        case 'ServerMsg$ShowMenu$':
                            $('.content').hide();
                            $('#menu').show();
                            break;
                        case 'ServerMsg$ShowGame':
                            $('.content').hide();
                            $('#level').show();
                            this.drawBoard();
                            break;
                        default:
                            alert("Unhandled message: " + msg.data)
                    }
                },

                drawBoard: function() {
                    let canvas = document.getElementById("can");
                    let ctx = canvas.getContext("2d");
                    ctx.moveTo(0,0);
                    ctx.lineTo(200,100);
                    ctx.stroke();
                    console.log(canvas.width + " " + canvas.height);

                }

            });
    </script>

</dom-module>
